From 88119c9e457ae09205edb5f045c3da9e977cf48c Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 11 Oct 2015 18:06:27 +0100
Subject: [PATCH] Convert to stateless configuration

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 src/mesa/drivers/dri/common/Makefile.am | 3 ++-
 src/mesa/drivers/dri/common/xmlconfig.c | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/mesa/drivers/dri/common/Makefile.am b/src/mesa/drivers/dri/common/Makefile.am
index b307f10..60ddbbf 100644
--- a/src/mesa/drivers/dri/common/Makefile.am
+++ b/src/mesa/drivers/dri/common/Makefile.am
@@ -53,4 +53,5 @@ libdri_test_stubs_la_CFLAGS = $(AM_CFLAGS) -DNO_MAIN
 
 libmegadriver_stub_la_SOURCES = $(megadriver_stub_FILES)
 
-sysconf_DATA = drirc
+defaultsdir = $(datadir)/defaults/mesa
+defaults_DATA = drirc
diff --git a/src/mesa/drivers/dri/common/xmlconfig.c b/src/mesa/drivers/dri/common/xmlconfig.c
index f17693e..237ae8c 100644
--- a/src/mesa/drivers/dri/common/xmlconfig.c
+++ b/src/mesa/drivers/dri/common/xmlconfig.c
@@ -937,7 +937,7 @@ static void parseOneConfigFile (XML_Parser p) {
 
 void driParseConfigFiles (driOptionCache *cache, const driOptionCache *info,
 			  int screenNum, const char *driverName) {
-    char *filenames[2] = {"/etc/drirc", NULL};
+    char *filenames[2] = {"/usr/share/defaults/mesa/drirc", NULL};
     char *home;
     uint32_t i;
     struct OptConfData userData;
-- 
2.6.0

