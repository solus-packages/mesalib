From f87f96432fbbd1237c07649f8143009038b07aae Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Thu, 9 Jul 2015 22:57:37 +0100
Subject: [PATCH] Convert to a stateless configuration

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 src/mesa/drivers/dri/common/Makefile.am | 3 ++-
 src/mesa/drivers/dri/common/xmlconfig.c | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/mesa/drivers/dri/common/Makefile.am b/src/mesa/drivers/dri/common/Makefile.am
index 2d6cb9d..1e24924 100644
--- a/src/mesa/drivers/dri/common/Makefile.am
+++ b/src/mesa/drivers/dri/common/Makefile.am
@@ -50,7 +50,8 @@ libdri_test_stubs_la_CFLAGS = $(AM_CFLAGS) -DNO_MAIN
 
 libmegadriver_stub_la_SOURCES = $(megadriver_stub_FILES)
 
-sysconf_DATA = drirc
+defaultsdir = $(datadir)/defaults/mesa
+defaults_DATA = drirc
 
 if DRICOMMON_NEED_LIBDRM
 AM_CFLAGS += $(LIBDRM_CFLAGS)
diff --git a/src/mesa/drivers/dri/common/xmlconfig.c b/src/mesa/drivers/dri/common/xmlconfig.c
index d69eb01..9366e96 100644
--- a/src/mesa/drivers/dri/common/xmlconfig.c
+++ b/src/mesa/drivers/dri/common/xmlconfig.c
@@ -934,7 +934,7 @@ static void parseOneConfigFile (XML_Parser p) {
 
 void driParseConfigFiles (driOptionCache *cache, const driOptionCache *info,
 			  int screenNum, const char *driverName) {
-    char *filenames[2] = {"/etc/drirc", NULL};
+    char *filenames[2] = {"/usr/share/defaults/mesa/drirc", NULL};
     char *home;
     uint32_t i;
     struct OptConfData userData;
-- 
2.4.5

